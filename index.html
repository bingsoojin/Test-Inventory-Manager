
<!DOCTYPE html>
<html>
<head>
    <meta charset='UTF-8'>
    <title>Inventory Manager</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #fff; color: #000; }
        h2 { font-size: 28px; font-weight: bold; color: #000; text-align: center; }
        .dark-mode h2 { color: #f4f4f4; }
        input, select, button { margin: 5px; padding: 8px; width: 300px; display: block; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
        .dark-mode { background-color: #121212; color: #f4f4f4; }
        .dark-mode table th { background-color: #333; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .left-controls { display: flex; gap: 10px; }
        .right-controls { display: flex; gap: 10px; align-items: center; }
        .icon-btn { background: none; border: none; cursor: pointer; font-size: 20px; }
    </style>
</head>
<body>
    <div class='top-bar'>
        <div class='left-controls'>
            <input type='text' id='skuInput' placeholder='Scan or Enter SKU' autofocus>
            <button onclick='checkSKU()'>Check</button>
        </div>
        <div class='right-controls'>
            <button onclick='exportExcel()'>Export Excel</button>
            <button onclick='exportJSON()'>Export JSON</button>
            <input type='file' id='importFile' style='display:none' accept='.json' onchange='importJSON(event)'>
            <button onclick="document.getElementById('importFile').click()">Import JSON</button>
            <button class='icon-btn' onclick='toggleDarkMode()' title='Toggle Dark Mode'>ðŸŒž/ðŸŒ™</button>
        </div>
    </div>
    <h2>Inventory Management</h2>
    <div id='formContainer' style='margin-top:20px;'></div>
    <table id='inventoryTable'>
        <thead>
            <tr>
                <th>SKU</th><th>Name</th><th>Description</th><th>Reference</th><th>Producer</th><th>Qty</th><th>Expiry</th><th>Type of consumable</th><th>Status</th><th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script src='https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js'></script>
    <script>
        let inventory = JSON.parse(localStorage.getItem('inventory') || '[]');

        function saveInventory() {
            localStorage.setItem('inventory', JSON.stringify(inventory));
            renderTable();
        }

        function renderTable() {
            const tbody = document.querySelector('#inventoryTable tbody');
            tbody.innerHTML = '';
            inventory.forEach((item, index) => {
                const row = `<tr>
                    <td>${item.sku}</td>
                    <td>${item.name}</td>
                    <td>${item.description}</td>
                    <td>${item.reference}</td>
                    <td>${item.producer}</td>
                    <td>${item.qty}</td>
                    <td>${item.expiry}</td>
                    <td>${item.type}</td>
                    <td>${item.status}</td>
                    <td><button onclick='editProduct(${index})'>Edit</button></td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function checkSKU() {
            const skuInput = document.getElementById('skuInput');
            const sku = skuInput.value.trim();
            if (!sku) return;
            const existing = inventory.find(item => item.sku === sku);
            const container = document.getElementById('formContainer');
            if (existing) {
                container.innerHTML = `<h3>Update Quantity for ${existing.name}</h3>
                    <p>Current Qty: ${existing.qty}</p>
                    <input type='number' id='newQty' placeholder='New Quantity'>
                    <button onclick='updateQty("${sku}")'>Update</button>`;
                setTimeout(() => {
                    const qtyField = document.getElementById('newQty');
                    qtyField.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            updateQty(sku);
                        }
                    });
                    qtyField.focus();
                }, 100);
            } else {
                const names = [...new Set(inventory.map(i => i.name))];
                const descriptions = [...new Set(inventory.map(i => i.description))];
                const producers = [...new Set(inventory.map(i => i.producer))];

                container.innerHTML = `<h3>Add New Product</h3>
                    <form id='addForm'>
                        <input type='hidden' name='sku' value='${sku}'>
                        Name: <input name='name' list='nameList' required><datalist id='nameList'>${names.map(n => `<option value='${n}'>`).join('')}</datalist>
                        Description: <input name='description' list='descList' required><datalist id='descList'>${descriptions.map(d => `<option value='${d}'>`).join('')}</datalist>
                        Reference: <input name='reference' required>
                        Producer: <input name='producer' list='prodList' required><datalist id='prodList'>${producers.map(p => `<option value='${p}'>`).join('')}</datalist>
                        Quantity: <input name='qty' type='number' required>
                        Expiry: <input name='expiry' placeholder='YYYY-MM-DD' required>
                        Type of consumable: <select name='type' required>
                            <option value='Tubing'>Tubing</option>
                            <option value='Dressing'>Dressing</option>
                            <option value='Sample vial'>Sample vial</option>
                            <option value='Metals'>Metals</option>
                            <option value='Other'>Other</option>
                        </select>
                        Status: <select name='status' id='statusField' required>
                            <option value='Sealed'>Sealed</option>
                            <option value='Unsealed'>Unsealed</option>
                            <option value='N/A'>N/A</option>
                            <option value='Damaged'>Damaged</option>
                        </select>
                        <button type='button' onclick='addProduct()'>Add Product</button>
                    </form>`;

                // Enter navigation between fields
                setTimeout(() => {
                    const form = document.getElementById('addForm');
                    const fields = Array.from(form.querySelectorAll('input, select'));
                    fields.forEach((field, idx) => {
                        field.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                                if (idx < fields.length - 1) {
                                    fields[idx + 1].focus();
                                } else {
                                    addProduct();
                                }
                            }
                        });
                    });
                    fields[0].focus();
                }, 100);
            }
            skuInput.value = '';
        }

        function updateQty(sku) {
            const newQty = parseInt(document.getElementById('newQty').value);
            if (!isNaN(newQty)) {
                const item = inventory.find(i => i.sku === sku);
                item.qty = newQty;
                saveInventory();
                document.getElementById('formContainer').innerHTML = '';
                document.getElementById('skuInput').focus();
            }
        }

        function addProduct() {
            const form = document.getElementById('addForm');
            const data = Object.fromEntries(new FormData(form).entries());
            data.qty = parseInt(data.qty);
            inventory.push(data);
            saveInventory();
            document.getElementById('formContainer').innerHTML = '';
            document.getElementById('skuInput').focus();
        }

        function editProduct(index) {
            const item = inventory[index];
            const container = document.getElementById('formContainer');
            container.innerHTML = `<h3>Edit Product</h3>
                <form id='editForm'>
                    SKU: <input name='sku' value='${item.sku}' readonly>
                    Name: <input name='name' value='${item.name}' required>
                    Description: <input name='description' value='${item.description}' required>
                    Reference: <input name='reference' value='${item.reference}' required>
                    Producer: <input name='producer' value='${item.producer}' required>
                    Quantity: <input name='qty' type='number' value='${item.qty}' required>
                    Expiry: <input name='expiry' value='${item.expiry}' required>
                    Type of consumable: <select name='type' required>
                        <option ${item.type==='Tubing'?'selected':''}>Tubing</option>
                        <option ${item.type==='Dressing'?'selected':''}>Dressing</option>
                        <option ${item.type==='Sample vial'?'selected':''}>Sample vial</option>
                        <option ${item.type==='Metals'?'selected':''}>Metals</option>
                        <option ${item.type==='Other'?'selected':''}>Other</option>
                    </select>
                    Status: <select name='status' required>
                        <option ${item.status==='Sealed'?'selected':''}>Sealed</option>
                        <option ${item.status==='Unsealed'?'selected':''}>Unsealed</option>
                        <option ${item.status==='N/A'?'selected':''}>N/A</option>
                        <option ${item.status==='Damaged'?'selected':''}>Damaged</option>
                    </select>
                    <button type='button' onclick='saveEdit(${index})'>Save Changes</button>
                </form>`;
        }

        function saveEdit(index) {
            const form = document.getElementById('editForm');
            const data = Object.fromEntries(new FormData(form).entries());
            data.qty = parseInt(data.qty);
            inventory[index] = data;
            saveInventory();
            document.getElementById('formContainer').innerHTML = '';
            document.getElementById('skuInput').focus();
        }

        function exportExcel() {
            const ws = XLSX.utils.json_to_sheet(inventory);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Inventory');
            XLSX.writeFile(wb, 'inventory_export.xlsx');
        }

        function exportJSON() {
            const blob = new Blob([JSON.stringify(inventory)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'inventory_backup.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (Array.isArray(data)) {
                        inventory = data;
                        saveInventory();
                    } else {
                        alert('Invalid JSON format');
                    }
                } catch {
                    alert('Error reading file');
                }
            };
            reader.readAsText(file);
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        document.getElementById('skuInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                checkSKU();
            }
        });

        renderTable();
    </script>
</body>
</html>
